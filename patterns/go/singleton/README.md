# Lazy 加载，线程安全—单例模式

- 解决场景：变量只想初始化一次。

APIX 在埋点中间件中通过单例模式实现了对变量延迟且线程安全地赋值。

Metrics()用来生成 Metric 埋点中间件，在加载的过程，由于 APIX 的路由表还未注册完毕，所以需要把两个变量 metricMap 和 pathMap 的初始化放在中间件的执行过程中，但服务器启动后，这两个变量的值是固定的，没必要反复初始化，其次大量请求过来时，中间件的逻辑会并发执行，存在线程不安全的问题。

故在实现的过程中用到了sync.Once对象，只要声明类型的 once 变量，就可以直接使用它的 Do 方法，Do 方法的参数是一个无参数，无返回的函数。

参考：https://mp.weixin.qq.com/s/S1BQ55yZgBlB4AkfPX-gIg
